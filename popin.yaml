openapi: 3.0.3
info:
  title: Partner Hub API
  description: API for managing partner hub schedules
  version: 1.0.0
  contact:
    name: API Support
    email: support@example.com

tags:
  - name: Schedule Management
    description: APIs for managing schedules
  - name: Agent Management
    description: APIs for managing agents

servers:
  - url: https://api.example.com
    description: Production server
  - url: https://staging.api.example.com
    description: Staging server

security:
  - BearerAuth: []

paths:
  /api/v1/partner-hub/schedule:
    post:
      summary: Create a new schedule
      description: Creates a new schedule with the provided details
      operationId: createSchedule
      tags:
        - Schedule Management
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateScheduleRequest'
            example:
              schedule_start_time: "2023-10-15T20:00:00+05:30"
              schedule_end_time: "2023-10-15T22:00:00+05:30"
              meta:
                callerId: "CALLER-12345"
                product:
                  id: "PROD-12345"
                  url: "https://cars24.com/inspect/PROD-12345"
                  image: "https://cars24.com/images/prod-12345.jpg"
                  name: "Car Inspection Service"
              name: "John Doe"
              group_identifier: "GROUP-001"
              retry_number: 3
              retry_interval: 10
      responses:
        '201':
          description: Schedule created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateScheduleResponse'
              example:
                schedule_id: 789012
                status: 1
                message: "Schedule created successfully"
        '400':
          description: Bad request - Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 0
                error: "validation_error"
                message: "Invalid input data"
                details:
                  - field: "schedule_id"
                    error: "Must be a valid integer"
        '401':
          description: Unauthorized - Invalid or missing bearer token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 0
                error: "unauthorized"
                message: "Invalid or missing bearer token"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 0
                error: "server_error"
                message: "Internal server error"

  /api/v1/partner-hub/schedule/{schedule_id}:
    put:
      summary: Reschedule an existing schedule
      description: Updates/reschedules an existing schedule with new details
      operationId: rescheduleSchedule
      tags:
        - Schedule Management
      security:
        - BearerAuth: []
      parameters:
        - name: schedule_id
          in: path
          required: true
          description: The unique identifier of the schedule to reschedule
          schema:
            type: integer
            example: 789012
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RescheduleRequest'
            example:
              schedule_start_time: "2023-10-16T21:30:00+05:30"
              schedule_end_time: "2023-10-16T23:30:00+05:30"
              meta:
                callerId: "CALLER-12345"
                product:
                  id: "PROD-12345"
                  url: "https://cars24.com/inspect/PROD-12345"
                  image: "https://cars24.com/images/prod-12345.jpg"
                  name: "Car Inspection Service - Updated"
              name: "John Doe"
              group_identifier: "GROUP-001"
              retry_number: 2
              retry_interval: 10
      responses:
        '200':
          description: Schedule rescheduled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RescheduleResponse'
              example:
                schedule_id: 890123
                status: 1
                message: "Schedule rescheduled with new ID successfully"
        '400':
          description: Bad request - Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 0
                error: "validation_error"
                message: "Invalid input data"
        '401':
          description: Unauthorized - Invalid or missing bearer token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 0
                error: "unauthorized"
                message: "Invalid or missing bearer token"
        '404':
          description: Schedule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 0
                error: "not_found"
                message: "Schedule with ID 789012 not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 0
                error: "server_error"
                message: "Internal server error"

    delete:
      summary: Cancel a schedule
      description: Cancels/deletes an existing schedule
      operationId: cancelSchedule
      tags:
        - Schedule Management
      security:
        - BearerAuth: []
      parameters:
        - name: schedule_id
          in: path
          required: true
          description: The unique identifier of the schedule to cancel
          schema:
            type: integer
            example: 789012
      responses:
        '200':
          description: Schedule cancelled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CancelScheduleResponse'
              example:
                schedule_id: 789012
                status: 1
                message: "Schedule cancelled successfully"
        '401':
          description: Unauthorized - Invalid or missing bearer token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteErrorResponse'
              example:
                status: 0
                error: "unauthorized"
                message: "Invalid or missing bearer token"
        '404':
          description: Schedule not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteErrorResponse'
              example:
                status: 0
                error: "not_found"
                message: "Schedule with ID 789012 not found"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteErrorResponse'
              example:
                status: 0
                error: "server_error"
                message: "Internal server error"

  /api/v1/partner-hub/agents:
    post:
      summary: Create or update an agent
      description: Creates a new agent or updates an existing agent. Creates group if not present, creates agent if not present, and adds agent to group. If agent exists with different group, updates agent to new group.
      operationId: createAgent
      tags:
        - Agent Management
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAgentRequest'
            example:
              name: "John Doe"
              email: "john.doe@example.com"
              group_identifier: "GROUP-001"
              group_name: "Customer Support Group"
      responses:
        '201':
          description: Agent created or updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateAgentResponse'
              example:
                agent_id: 12345
                status: 1
                message: "Agent created and added to group successfully"
        '400':
          description: Bad request - Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 0
                error: "validation_error"
                message: "Invalid input data"
                details:
                  - field: "email"
                    error: "Must be a valid email address"
        '401':
          description: Unauthorized - Invalid or missing bearer token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 0
                error: "unauthorized"
                message: "Invalid or missing bearer token"
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 0
                error: "server_error"
                message: "Internal server error"


components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Bearer token authentication

  schemas:
    CreateScheduleRequest:
      type: object
      required:
        - schedule_start_time
        - schedule_end_time
        - meta
        - name
        - group_identifier
        - retry_number
        - retry_interval
      properties:
        schedule_start_time:
          type: string
          format: date-time
          description: Scheduled start time in ISO8601 format
          example: "2023-10-15T20:00:00+05:30"
        schedule_end_time:
          type: string
          format: date-time
          description: Scheduled end time in ISO8601 format
          example: "2023-10-15T22:00:00+05:30"
        meta:
          type: object
          required:
            - callerId
            - product
          properties:
            callerId:
              type: string
              description: Caller identifier
              example: "CALLER-12345"
            product:
              type: object
              required:
                - id
                - url
                - image
                - name
              properties:
                id:
                  type: string
                  description: Unique identifier for the product
                  example: "PROD-12345"
                url:
                  type: string
                  format: uri
                  description: Deep link URL for the product
                  example: "https://cars24.com/inspect/PROD-12345"
                image:
                  type: string
                  format: uri
                  description: Image URL for the product
                  example: "https://cars24.com/images/prod-12345.jpg"
                name:
                  type: string
                  description: Name of the product
                  example: "Car Inspection Service"
        name:
          type: string
          description: Name for the schedule
          minLength: 1
          maxLength: 100
          example: "John Doe"
        group_identifier:
          type: string
          description: Group identifier for the schedule
          example: "GROUP-001"
        retry_number:
          type: integer
          description: Number of retry attempts
          minimum: 0
          maximum: 10
          example: 3
        retry_interval:
          type: integer
          description: Retry interval in minutes
          minimum: 1
          maximum: 10080
          example: 10

    RescheduleRequest:
      type: object
      required:
        - schedule_start_time
        - schedule_end_time
        - meta
        - name
        - group_identifier
        - retry_number
        - retry_interval
      properties:
        schedule_start_time:
          type: string
          format: date-time
          description: Scheduled start time in ISO8601 format
          example: "2023-10-16T21:30:00+05:30"
        schedule_end_time:
          type: string
          format: date-time
          description: Scheduled end time in ISO8601 format
          example: "2023-10-16T23:30:00+05:30"
        meta:
          type: object
          required:
            - callerId
            - product
          properties:
            callerId:
              type: string
              description: Caller identifier
              example: "CALLER-12345"
            product:
              type: object
              required:
                - id
                - url
                - image
                - name
              properties:
                id:
                  type: string
                  description: Unique identifier for the product
                  example: "PROD-12345"
                url:
                  type: string
                  format: uri
                  description: Deep link URL for the product
                  example: "https://cars24.com/inspect/PROD-12345"
                image:
                  type: string
                  format: uri
                  description: Image URL for the product
                  example: "https://cars24.com/images/prod-12345.jpg"
                name:
                  type: string
                  description: Name of the product
                  example: "Car Inspection Service - Updated"
        name:
          type: string
          description: Name for the schedule
          minLength: 1
          maxLength: 100
          example: "John Doe"
        group_identifier:
          type: string
          description: Group identifier for the schedule
          example: "GROUP-001"
        retry_number:
          type: integer
          description: Number of retry attempts
          minimum: 0
          maximum: 10
          example: 2
        retry_interval:
          type: integer
          description: Retry interval in minutes
          minimum: 1
          maximum: 10080
          example: 10

    CreateScheduleResponse:
      type: object
      required:
        - schedule_id
        - status
        - message
      properties:
        schedule_id:
          type: integer
          description: Unique identifier for the created schedule
          example: 789012
        status:
          type: integer
          description: Status of the operation (1 = success, 0 = failure)
          enum: [0, 1]
          example: 1
        message:
          type: string
          description: Success message
          example: "Schedule created successfully"

    RescheduleResponse:
      type: object
      required:
        - schedule_id
        - status
        - message
      properties:
        schedule_id:
          type: integer
          description: New unique identifier for the rescheduled schedule
          example: 890123
        status:
          type: integer
          description: Status of the operation (1 = success, 0 = failure)
          enum: [0, 1]
          example: 1
        message:
          type: string
          description: Success message
          example: "Schedule rescheduled with new ID successfully"

    CancelScheduleResponse:
      type: object
      required:
        - schedule_id
        - status
        - message
      properties:
        schedule_id:
          type: integer
          description: Unique identifier for the cancelled schedule
          example: 789012
        status:
          type: integer
          description: Status of the operation (1 = success, 0 = failure)
          enum: [0, 1]
          example: 1
        message:
          type: string
          description: Success message
          example: "Schedule cancelled successfully"

    ErrorResponse:
      type: object
      required:
        - status
        - error
        - message
      properties:
        status:
          type: integer
          description: Status of the operation (1 = success, 0 = failure)
          enum: [0, 1]
          example: 0
        error:
          type: string
          description: Error type
          example: "validation_error"
        message:
          type: string
          description: Error message
          example: "Invalid input data"
        details:
          type: array
          description: Detailed error information
          items:
            type: object
            properties:
              field:
                type: string
                example: "schedule_id"
              error:
                type: string
                example: "Must be a valid integer"

    DeleteErrorResponse:
      type: object
      required:
        - status
        - error
        - message
      properties:
        status:
          type: integer
          description: Status of the operation (1 = success, 0 = failure)
          enum: [0, 1]
          example: 0
        error:
          type: string
          description: Error type
          example: "not_found"
        message:
          type: string
          description: Error message
          example: "Resource not found"

    AgentsResponse:
      type: object
      required:
        - status
        - agents
      properties:
        status:
          type: integer
          description: Status of the operation (1 = success, 0 = failure)
          enum: [1]
          example: 1
        agents:
          type: array
          description: List of online agent email addresses
          items:
            type: string
            format: email
            example: "agent1@example.com"

    CreateAgentRequest:
      type: object
      required:
        - name
        - email
        - group_identifier
      properties:
        name:
          type: string
          description: Full name of the agent
          minLength: 1
          maxLength: 100
          example: "John Doe"
        email:
          type: string
          format: email
          description: Email address of the agent
          example: "john.doe@example.com"
        group_identifier:
          type: string
          description: Unique identifier for the group
          minLength: 1
          maxLength: 50
          example: "GROUP-001"
        group_name:
          type: string
          description: Display name of the group
          minLength: 1
          maxLength: 100
          example: "Customer Support Group"

    CreateAgentResponse:
      type: object
      required:
        - agent_id
        - status
        - message
      properties:
        agent_id:
          type: integer
          description: Unique identifier for the created or updated agent
          example: 12345
        status:
          type: integer
          description: Status of the operation (1 = success, 0 = failure)
          enum: [0, 1]
          example: 1
        message:
          type: string
          description: Success message
          example: "Agent created and added to group successfully"

